{
  "generated_at": "2026-02-21",
  "scope": "All files currently present under backend/",
  "purpose": "File-by-file WH map for API development and maintenance",
  "wh_family_covered": [
    "what",
    "why",
    "who",
    "when",
    "where",
    "how",
    "which"
  ],
  "files": [
    {
      "path": "backend/__init__.py",
      "what": "Marks backend as a Python package.",
      "why": "Allows package imports like backend.routes and backend.services.",
      "who": "Python import system and API runtime.",
      "when": "Whenever backend modules are imported.",
      "where": "Package root for the API app.",
      "how": "By existing as package marker file.",
      "which": "Needed for package resolution.",
      "required_for_api": true,
      "summary": "Package marker for the backend application."
    },
    {
      "path": "backend/backend_file_wh_map.json",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": false,
      "summary": "Inventory map describing purpose and ownership of backend files."
    },
    {
      "path": "backend/core/__init__.py",
      "what": "Marks core directory as package.",
      "why": "Allows backend.core.* imports from services.",
      "who": "Python import system.",
      "when": "Whenever core modules are imported.",
      "where": "Core package root.",
      "how": "Package marker file.",
      "which": "Needed for import resolution.",
      "required_for_api": true,
      "summary": "Package marker for core backend infrastructure modules."
    },
    {
      "path": "backend/core/analyze.py",
      "what": "LLM-driven impact analysis utilities.",
      "why": "Builds structured impact output from regulatory context.",
      "who": "analysis_service.py.",
      "when": "During analysis requests requiring deeper AI assessment.",
      "where": "Core analysis layer.",
      "how": "Combines system instructions + retrieved context + model call.",
      "which": "Runtime dependency for analysis endpoint.",
      "required_for_api": true,
      "summary": "Impact analysis orchestration for structured LLM output."
    },
    {
      "path": "backend/core/cache.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Async Redis cache client with namespaced keys and TTL support."
    },
    {
      "path": "backend/core/config.py",
      "what": "Central configuration loader and defaults.",
      "why": "Provides data paths, model settings, thresholds, and validation.",
      "who": "All runtime core/services modules.",
      "when": "At module import and app startup.",
      "where": "Core foundation layer.",
      "how": "Loads .env and builds config singleton.",
      "which": "Required runtime dependency.",
      "required_for_api": true,
      "summary": "Typed environment settings and runtime configuration validation."
    },
    {
      "path": "backend/core/container.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Dependency container for cache, LLM, vector, and service singletons."
    },
    {
      "path": "backend/core/error_handlers.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Global FastAPI exception handlers returning structured API errors."
    },
    {
      "path": "backend/core/exceptions.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Domain exception classes with standardized error metadata."
    },
    {
      "path": "backend/core/llm_client.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Async-safe Gemini client wrapper with timeout, retries, and telemetry."
    },
    {
      "path": "backend/core/logging_config.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Structured JSON logging formatter and logger setup."
    },
    {
      "path": "backend/core/metrics.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Prometheus counters/histograms and metrics rendering helper."
    },
    {
      "path": "backend/core/rag_pipeline.py",
      "what": "Regulatory context retrieval pipeline.",
      "why": "Fetches relevant policy context for analysis and assistant.",
      "who": "analysis_service.py and assistant_service.py.",
      "when": "During analysis/chat requests.",
      "where": "Core retrieval layer.",
      "how": "Uses Chroma similarity + metadata filtering + embeddings.",
      "which": "Required runtime dependency.",
      "required_for_api": true,
      "summary": "Retrieval pipeline combining embeddings, vector search, and filtering."
    },
    {
      "path": "backend/core/sanitize.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Prompt-injection checks and output text sanitization utilities."
    },
    {
      "path": "backend/core/security.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "JWT authentication and role-based authorization helpers."
    },
    {
      "path": "backend/core/vector_store.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "External Chroma HTTP client with typed retrieval responses."
    },
    {
      "path": "backend/data/org_data.json",
      "what": "Organization profile sample/reference data.",
      "why": "Provides organization context for analysis workflows.",
      "who": "Analysis-related logic and developers/testing flows.",
      "when": "When org profile is read from file-based flow.",
      "where": "Backend data directory.",
      "how": "JSON payload consumed as org context.",
      "which": "Optional at runtime if request payload already includes org profile.",
      "required_for_api": false,
      "summary": "Organization profile sample/reference data for analysis workflows."
    },
    {
      "path": "backend/data/policies/Gazetted_data_18-02-2026.json",
      "what": "Raw policy/gazette dataset.",
      "why": "Source data used to build policy context/vector content.",
      "who": "Data ingestion/preprocessing workflows.",
      "when": "Before/while preparing vector store.",
      "where": "Policy data folder.",
      "how": "Structured JSON source document.",
      "which": "Not directly called by API routes; supports data pipeline.",
      "required_for_api": false,
      "summary": "Source policy/gazette dataset used for policy context preparation."
    },
    {
      "path": "backend/data/policies/RBI/policy_name/metadata.json",
      "what": "Metadata for RBI sample policy versions.",
      "why": "Tracks policy identity/version attributes.",
      "who": "Ingestion/versioning workflows.",
      "when": "During policy ingestion or version checks.",
      "where": "Policy version folder.",
      "how": "JSON metadata file.",
      "which": "Pipeline support data, not direct route dependency.",
      "required_for_api": false,
      "summary": "Metadata for RBI sample policy versions and processing status."
    },
    {
      "path": "backend/data/policies/RBI/policy_name/v1.txt",
      "what": "Older policy text version.",
      "why": "Enables historical comparison and ingestion.",
      "who": "Ingestion/diff workflows.",
      "when": "When building change history or embeddings.",
      "where": "Policy version folder.",
      "how": "Plain text regulatory document.",
      "which": "Pipeline support data.",
      "required_for_api": false,
      "summary": "Baseline RBI policy text sample (version 1)."
    },
    {
      "path": "backend/data/policies/RBI/policy_name/v2.txt",
      "what": "Newer policy text version.",
      "why": "Latest policy content for retrieval and analysis context.",
      "who": "Ingestion/diff workflows and vector-store build process.",
      "when": "When refreshing embeddings/context base.",
      "where": "Policy version folder.",
      "how": "Plain text regulatory document.",
      "which": "Pipeline support data.",
      "required_for_api": false,
      "summary": "Updated RBI policy text sample (version 2)."
    },
    {
      "path": "backend/data/vector_store/2c83ab29-05f6-486a-a2c9-dc5ce304938d/data_level0.bin",
      "what": "Binary vector index segment.",
      "why": "Stores indexed vector data for similarity search.",
      "who": "Chroma internals via retrieval pipeline.",
      "when": "During vector similarity queries.",
      "where": "Vector store collection shard folder.",
      "how": "Binary ANN index data.",
      "which": "Required when using existing persisted vector index.",
      "required_for_api": true,
      "summary": "Binary ANN index data segment for persisted vector search."
    },
    {
      "path": "backend/data/vector_store/2c83ab29-05f6-486a-a2c9-dc5ce304938d/header.bin",
      "what": "Binary index header metadata.",
      "why": "Describes vector index structure.",
      "who": "Chroma internals.",
      "when": "When loading vector index files.",
      "where": "Vector store collection shard folder.",
      "how": "Binary header format.",
      "which": "Required for persisted index integrity.",
      "required_for_api": true,
      "summary": "Binary header metadata for persisted vector index structure."
    },
    {
      "path": "backend/data/vector_store/2c83ab29-05f6-486a-a2c9-dc5ce304938d/length.bin",
      "what": "Binary index length/size metadata.",
      "why": "Helps index traversal and storage layout.",
      "who": "Chroma internals.",
      "when": "On index load/query.",
      "where": "Vector store collection shard folder.",
      "how": "Binary metadata file.",
      "which": "Required for persisted index integrity.",
      "required_for_api": true,
      "summary": "Binary length metadata for persisted vector index layout."
    },
    {
      "path": "backend/data/vector_store/2c83ab29-05f6-486a-a2c9-dc5ce304938d/link_lists.bin",
      "what": "Binary graph/link structure for ANN search.",
      "why": "Enables fast nearest-neighbor traversal.",
      "who": "Chroma internals during similarity retrieval.",
      "when": "During vector search operations.",
      "where": "Vector store collection shard folder.",
      "how": "Binary graph data consumed by index engine.",
      "which": "Required for persisted index integrity.",
      "required_for_api": true,
      "summary": "Binary graph/link metadata for ANN traversal in vector search."
    },
    {
      "path": "backend/data/vector_store/chroma.sqlite3",
      "what": "ChromaDB metadata/state database file.",
      "why": "Backs vector collection state used by API retrieval.",
      "who": "rag_pipeline.py and services querying Chroma.",
      "when": "At every retrieval/lookup operation.",
      "where": "Vector store persistence directory.",
      "how": "SQLite persistence used by Chroma.",
      "which": "Required data artifact for current retrieval behavior.",
      "required_for_api": true,
      "summary": "Chroma persistence metadata database used by vector retrieval."
    },
    {
      "path": "backend/main.py",
      "what": "FastAPI application entrypoint with router registration.",
      "why": "Bootstraps API server and exposes endpoints.",
      "who": "Uvicorn/FastAPI runtime and frontend clients.",
      "when": "At API startup and per incoming request.",
      "where": "Top-level backend app module.",
      "how": "Creates app, adds CORS middleware, includes route modules.",
      "which": "Primary runtime file for API development.",
      "required_for_api": true,
      "summary": "FastAPI app bootstrap, middleware wiring, and router registration."
    },
    {
      "path": "backend/middleware/limits.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Request size limit and distributed rate limit middleware."
    },
    {
      "path": "backend/middleware/metrics.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "HTTP metrics middleware for request count and latency tracking."
    },
    {
      "path": "backend/middleware/request_context.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Correlation ID propagation and request logging middleware."
    },
    {
      "path": "backend/routes/__init__.py",
      "what": "Marks routes directory as importable package.",
      "why": "Enables structured route module imports.",
      "who": "Python import system.",
      "when": "When routes are imported by backend.main.",
      "where": "Route package root.",
      "how": "Package marker file.",
      "which": "Needed for route package imports.",
      "required_for_api": true,
      "summary": "Package marker for API route modules."
    },
    {
      "path": "backend/routes/analysis.py",
      "what": "Impact analysis endpoint definition.",
      "why": "Runs AI impact analysis for an organization profile.",
      "who": "Frontend analysis page and AnalysisService.",
      "when": "On /api/analysis/run POST requests.",
      "where": "Route layer.",
      "how": "Validates payload and calls AnalysisService.",
      "which": "Used route module.",
      "required_for_api": true,
      "summary": "Analysis route handlers with validation and RBAC enforcement."
    },
    {
      "path": "backend/routes/assistant.py",
      "what": "Assistant chat endpoint definition.",
      "why": "Provides regulatory Q&A over RAG context.",
      "who": "Frontend chat UI and AssistantService.",
      "when": "On /api/assistant/chat POST requests.",
      "where": "Route layer.",
      "how": "Validates input and forwards to AssistantService.chat.",
      "which": "Used route module.",
      "required_for_api": true,
      "summary": "Assistant chat route handlers with validation and RBAC enforcement."
    },
    {
      "path": "backend/routes/dashboard.py",
      "what": "Dashboard summary endpoint definitions.",
      "why": "Provides dashboard metrics to UI.",
      "who": "Frontend dashboard and dashboard service.",
      "when": "On /api/dashboard requests.",
      "where": "Route layer.",
      "how": "Calls DashboardService and returns response/errors.",
      "which": "Used route module.",
      "required_for_api": true,
      "summary": "Dashboard summary route handlers with RBAC enforcement."
    },
    {
      "path": "backend/routes/health.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Health and readiness endpoints with dependency checks."
    },
    {
      "path": "backend/routes/metrics.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Prometheus scrape endpoint for operational metrics."
    },
    {
      "path": "backend/routes/registry.py",
      "what": "Policy registry/list/detail endpoint definitions.",
      "why": "Exposes stored policy inventory and single policy fetch.",
      "who": "Frontend policy registry views and dashboard service.",
      "when": "On /api/policies requests.",
      "where": "Route layer.",
      "how": "Delegates to DashboardService methods.",
      "which": "Used route module.",
      "required_for_api": true,
      "summary": "Policy registry/detail route handlers with RBAC enforcement."
    },
    {
      "path": "backend/schemas/__init__.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Package marker for request/response schema models."
    },
    {
      "path": "backend/schemas/analysis.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Pydantic schemas for analysis request/response payloads."
    },
    {
      "path": "backend/schemas/assistant.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Pydantic schemas for assistant chat request/response payloads."
    },
    {
      "path": "backend/schemas/common.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Shared API response schemas including error and health models."
    },
    {
      "path": "backend/schemas/dashboard.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Pydantic schemas for dashboard and policy response payloads."
    },
    {
      "path": "backend/schemas/retrieval.py",
      "what": "Backend file.",
      "why": "Supports backend functionality.",
      "who": "Backend runtime and developers.",
      "when": "As needed by backend operations.",
      "where": "Within backend workspace.",
      "how": "Used directly by code or as runtime data.",
      "which": "Part of backend file inventory.",
      "required_for_api": true,
      "summary": "Typed schemas for vector query and retrieval pipeline payloads."
    },
    {
      "path": "backend/services/__init__.py",
      "what": "Marks services directory as package.",
      "why": "Supports clean service imports from routes.",
      "who": "Python import system.",
      "when": "When route modules import services.",
      "where": "Service package root.",
      "how": "Package marker file.",
      "which": "Needed for package import stability.",
      "required_for_api": true,
      "summary": "Package marker for service-layer modules."
    },
    {
      "path": "backend/services/analysis_service.py",
      "what": "Business logic for impact analysis responses.",
      "why": "Transforms retrieved policies into risk/impact outputs.",
      "who": "analysis.py route.",
      "when": "During analysis API calls.",
      "where": "Service layer.",
      "how": "Uses RAG pipeline + analyzer + scoring + cache.",
      "which": "Core runtime service.",
      "required_for_api": true,
      "summary": "Business logic for impact analysis and cached responses."
    },
    {
      "path": "backend/services/assistant_service.py",
      "what": "Business logic for assistant chat responses.",
      "why": "Builds context and generates AI assistant answer.",
      "who": "assistant.py route.",
      "when": "During assistant API calls.",
      "where": "Service layer.",
      "how": "Uses RAG retrieval, prompt building, Gemini generation, cache.",
      "which": "Core runtime service.",
      "required_for_api": true,
      "summary": "Business logic for assistant responses and context caching."
    },
    {
      "path": "backend/services/dashboard_service.py",
      "what": "Dashboard and policy retrieval business logic.",
      "why": "Computes summary stats and policy read operations.",
      "who": "dashboard.py and registry.py routes.",
      "when": "During dashboard/registry requests.",
      "where": "Service layer.",
      "how": "Reads from Chroma metadata/documents with light caching.",
      "which": "Core runtime service.",
      "required_for_api": true,
      "summary": "Business logic for dashboard metrics and policy lookups."
    }
  ],
  "api_dev_focus_summary": {
    "must_keep_for_api_code": [
      "backend/main.py",
      "backend/routes/*.py",
      "backend/services/*.py",
      "backend/core/config.py",
      "backend/core/rag_pipeline.py",
      "backend/core/analyze.py",
      "backend/core/gemini_utils.py",
      "backend/core/gemini_utils_v2.py",
      "backend/__init__.py",
      "backend/routes/__init__.py",
      "backend/services/__init__.py",
      "backend/core/__init__.py"
    ],
    "must_keep_for_api_data_runtime": [
      "backend/data/vector_store/**"
    ],
    "optional_or_pipeline_data": [
      "backend/data/org_data.json",
      "backend/data/policies/**"
    ]
  }
}
